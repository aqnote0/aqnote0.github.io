---
layout: default
---

# 数学知识：对极几何

## 概念

- $O_l$ 左相机光心
- $O_r$ 右相机光心
- $P_w$ 物点（世界坐标系）
  ，$P_w = \left[\begin{matrix} x_w \\ y_w \\ z_w \end{matrix}\right]$
- $P_{wl}$ 左相机观察到的物点（世界坐标系）
- $P_{wr}$ 右相机观察到的物点（世界坐标系）
- $P_c$ 像点（相机坐标系）
  ，$P_c = \left[\begin{matrix} x_c \\ y_c \\ z_c \end{matrix}\right]$
- $P_{cl}$ 左相机观察到的像点（相机坐标系）
- $P_{cr}$ 右相机观察到的像点（相机坐标系）
- $P_i$ 像点（图像坐标系）
  ，$P_i = \left[\begin{matrix} u \\ v \\ 1 \end{matrix}\right]$
- $P_{il}$ 左相机观察到的像点（图像坐标系）
- $P_{ir}$ 右相机观察到的像点（图像坐标系）
- $R$ 右相机相对于左相机的旋转矩阵，$R$是一个正交矩阵，得$R^T = R^{-1}$
- $T$ 右相机相对于左相机的平移矩阵
- $M_l$ 左相机内参，$M_l = \left[\begin{matrix}\end{matrix}\right]$
- $M_r$ 右相机内参，$M_r = \left[\begin{matrix}\end{matrix}\right]$
- $D_l$ 左相机畸变
- $D_r$ 右相机畸变

## 公式

**已知 R、T 和左相机位置 $P_{wl}$，计算右相机物点**：

$$
P_{wr} = R (P_{wl} - T) \tag{01}
$$

**已知 R、T 和右相机位置 $P_{wr}$，计算左相机物点**：

$$
P_{wl} = R\!^{-1} \; P_{wr} \; + \; T \tag{02}
$$

**对极平面关系**：

$$
(P_{wl} - T)\!^T \cdot (P_{wl} \times T) = 0  \tag{03}
$$

_说明_：

- 对极平面和发其法向量的点积为 0
- $P_l - T$ 表示对极平面上的向量
- $P_l \times T$ 是对极平面上两个向量的叉积，结算结果是对极平面的法向量
- 两个向量的点积 为 0

## 世界坐标极线约束 推导过程

由 (02) 及 R 是正交矩阵，带入 (03) 得：

$$
(R^{-1} \; P_{wr})\!^T \cdot (P_{wl} \times T) = 0 \tag{04}
$$

向量叉积可表示矩阵和向量的乘积，设 T 的矩阵标示为 S：

$$
S =
\left[
\begin{matrix}
  0     & -T_z  & T_y   \\
  T_z   & 0     & -T_x  \\
  -T_y  & T_x   & 0
\end{matrix}  \tag{05}
\right]
$$

得

$$
P_{wl} \times T = S \times P_{wl} \tag{06}
$$

将 (06) 带入 (04) 得到

$$
P_{wr}\!^T \; R \; S \; P_{wl} = 0 \tag{07}
$$

求得：EssentialMatrix|本征矩阵。E 不是满秩，他的秩未 2

$$
E = RS    \tag{08}
$$

**说明**：

- 本质矩阵 E（Essential Matrix）：反映【空间一点 P 的像点】在【不同视角摄像机】
  下【摄像机坐标系】中的表示之间的关系
- E 包含了 平移 T 和 旋转 R 的所有信息。
- E 将左相机观测到的点$P_{cl}$的相机坐标与右相机观察到的相机坐标$P_{cr}$关联起来
  。
- T 和 R 描述了一台相机相对另一台相机在全局坐标系中的相对位置。

终得：

$$
P_{wr}^T \; E \; P_{wl} = 0 \tag{09}
$$

## 相机坐标极限约束 推导过程

由于 世界坐标和相机坐标关系 映射关系如下：

$$
P_c = f \, \frac{P_w}{Z}  \tag{10}
$$

终得：

$$
P_{cr}^T \; E \; P_{cl} = 0   \tag{11}
$$

由于 E 不满秩，在已知 $P_{cr}$ 、 $E$ 求解 $P_{cl}$ 或则 已知 $P_{cl}$ 、 $E$ 求
解 $P_{cr}$ 得到的是一条直线，我们称之为**对极线**

## 图像坐标极限约束 推导过程

由 相机坐标和图像坐标关系：

$$
P_c = M^{-1} \; P_i       \tag{12}
$$

代入得：

$$
(M_r^{-1} \, P_i)^T \, E \, (M_l^{-1} \, P_i) = 0  \tag{13}
$$

转置分解：

$$
P_{ir}^T \, ({M_r}^{-1})^T \, E \, {M_l}^{-1} \, P_{il}  = 0      \tag{14}
$$

求得：FundamentalMatrix|基础矩阵。从左摄像头到右摄像头的转换关系

$$
F = M_r^{-1} \, E \, M_l^{-1}
$$

**说明**：

- 基础矩阵 F（Fundamental Matrix）：反映【空间一点 P 的像素点】在【不同视角摄像
  机】下【图像坐标系】中的表示之间的关系。
- F 除了包含你 E 的信息外，还包含了两个相机的内参，因此可以在图像坐标系中将两个
  相机关联起来。
- F 是将左相机观测到的图像坐标 P*{il}和右相机 P*{ir}关联起来

终得：

$$
P_{ir}^T \, F \, P_{il} = 0
$$
